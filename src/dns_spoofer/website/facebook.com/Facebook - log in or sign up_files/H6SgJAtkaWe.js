if (self.CavalryLogger) { CavalryLogger.start_js_script(document.currentScript); }/*FB_PKG_DELIM*/

__d("AvailableListConstants",[],(function(a,b,c,d,e,f){a=Object.freeze({ON_AVAILABILITY_CHANGED:"buddylist/availability-changed",ON_UPDATE_ERROR:"buddylist/update-error",ON_UPDATED:"buddylist/updated",ON_CHAT_NOTIFICATION_CHANGED:"chat-notification-changed",OFFLINE:0,IDLE:1,ACTIVE:2,MOBILE:3,WEB_STATUS:"webStatus",FB_APP_STATUS:"fbAppStatus",MESSENGER_STATUS:"messengerStatus",OTHER_STATUS:"otherStatus",STATUS_ACTIVE:"active",STATUS_IDLE:"idle",STATUS_OFFLINE:"offline"});f["default"]=a}),66);
__d("PresenceUtil",["CurrentUser","randomInt"],(function(a,b,c,d,e,f,g){var h=c("randomInt")(0,4294967295)+1;function a(){return h}function b(){return c("CurrentUser").isLoggedInNow()}g.getSessionID=a;g.hasUserCookie=b}),98);
__d("PresencePrivacy",["Arbiter","ArbiterMixin","AsyncRequest","Bootloader","ChannelConstants","CurrentUser","PresencePrivacyInitialData","PresenceUtil","mixin"],(function(a,b,c,d,e,f,g){var h="/ajax/chat/privacy/settings.php",i="/ajax/chat/privacy/online_policy.php",j="/ajax/chat/privacy/visibility.php",k="friend_visibility",l="visibility",m="online_policy",n=babelHelpers["extends"]({},d("PresencePrivacyInitialData").privacyData),o=d("PresencePrivacyInitialData").visibility,p=babelHelpers["extends"]({},d("PresencePrivacyInitialData").privacyData),q=o,r=d("PresencePrivacyInitialData").onlinePolicy,s=r,t=[],u=!1;b=function(a){babelHelpers.inheritsLoose(b,a);function b(){var b,c;for(var d=arguments.length,e=new Array(d),f=0;f<d;f++)e[f]=arguments[f];return(b=c=a.call.apply(a,[this].concat(e))||this,c.WHITELISTED=1,c.BLACKLISTED=-1,c.UNLISTED=0,c.ONLINE=1,c.OFFLINE=0,c.ONLINE_TO_WHITELIST=0,c.ONLINE_TO_BLACKLIST=1,b)||babelHelpers.assertThisInitialized(c)}var c=b.prototype;c.init=function(a,b,c){};c.setVisibility=function(a){q=o;z(a);var b={visibility:a},c={type:l,visibility:a};b=H(j,b,c);C(b,c);return a};c.getVisibility=function(){return o};c.setOnlinePolicy=function(a){s=r;A(a);var b={online_policy:a},c={type:m,online_policy:a};b=H(i,b,c);C(b,c);return a};c.getOnlinePolicy=function(){return r};c.getFriendVisibility=function(a){return n[a]||v.UNLISTED};c.getFriendsVisibility=function(){return n};c.isUserOffline=function(){return this.getVisibility()===v.OFFLINE};c.allows=function(a){return this.isUserOffline()?!1:this.allowsIfViewerIsOnline(a)};c.allowsIfViewerIsOnline=function(a){var b=this.getOnlinePolicy();return b===v.ONLINE_TO_WHITELIST?n[a]==v.WHITELISTED:n[a]!=v.BLACKLISTED};c.getOnlinePolicyStr=function(){if(this.isUserOffline())return"offline";var a=this.getOnlinePolicy();if(a===v.ONLINE_TO_WHITELIST)return"online_to_whitelist";return a===v.ONLINE_TO_BLACKLIST?"online_to_blacklist":"unknown"};c.setFriendsVisibility=function(a,b){if(a.length>0){var c={};for(var d=0;d<a.length;d++){var e=a[d];p[e]=n[e];c[e]=b}w(c);e=b;e==v.UNLISTED&&(e=p[a[0]]);d={users:a,setting:b,setting_type:e};a={type:k,settings:c};e=H(h,d,a);C(e,a)}return b};c.setFriendVisibilityMap=function(a,b){for(var c in a)p[c]=n[c];w(a);c={type:k,settings:a};C(G(b,c),c)};c.allow=function(a){if(this.allows(a))throw new Error("allow() should only be called for users that are not already allowed");if(this.getVisibility()===v.OFFLINE)throw new Error("allow() should only be called when the user is already online");var b=this.getOnlinePolicy()===v.ONLINE_TO_WHITELIST?v.WHITELISTED:v.UNLISTED;return this.setFriendsVisibility([a],b)};c.disallow=function(a){if(!this.allows(a))throw new Error("disallow() should only be called for users that are not already disallowed");if(this.getVisibility()===v.OFFLINE)throw new Error("disallow() should only be called when the user is already online");var b=this.getOnlinePolicy()===v.ONLINE_TO_BLACKLIST?v.BLACKLISTED:v.UNLISTED;return this.setFriendsVisibility([a],b)};c.getBlacklist=function(){var a=[];for(var b in n)n[b]===v.BLACKLISTED&&a.push(b);return a};c.getWhitelist=function(){var a=[];for(var b in n)n[b]===v.WHITELISTED&&a.push(b);return a};c.getMapForTest=function(){return n};c.setMapForTest=function(a){n=a};return b}(c("mixin")(c("ArbiterMixin")));var v=new b();function w(a){var b;for(b in a){var d=a[b];if(b==c("CurrentUser").getID())throw new Error("Invalid to set current user's visibility");switch(d){case v.WHITELISTED:case v.BLACKLISTED:case v.UNLISTED:break;default:throw new Error("Invalid state: "+d)}}for(b in a)n[b]=a[b];v.inform("privacy-changed")}function x(a,b){var c={};c[a]=b;w(c)}function y(a){c("Bootloader").loadModules(["MessengerMQTTPresenceReporting"],function(b){b.reportChatVisibility(!!a)},"PresencePrivacy")}function z(a){switch(a){case v.ONLINE:case v.OFFLINE:break;default:throw new Error("Invalid visibility: "+a)}o=a;y(a);v.inform("privacy-changed");v.inform("privacy-user-presence-changed")}function A(a){switch(a){case v.ONLINE_TO_WHITELIST:case v.ONLINE_TO_BLACKLIST:break;default:throw new Error("Invalid default online policy: "+a)}r=a;v.inform("privacy-user-presence-changed");v.inform("privacy-changed")}function B(a,b){u=!0,a.send()}function C(a,b){t.push({request:a,data:b});if(!u){a=t.shift();B(a.request,a.data)}}function D(a,b){b=a.type;if(b===k){v.inform("privacy-availability-changed");for(var c in a.settings)p[c]=a.settings[c]}else b===l?q=a.visibility:b===m&&(s=a.online_policy),v.inform("privacy-user-presence-response")}function E(a,b){o!==q&&z(q),r!==s&&A(s),Object.assign(n,p),v.inform("privacy-changed"),t=[]}function F(a){u=!1;if(t.length>0){a=t.shift();B(a.request,a.data)}}function G(a,b){if(d("PresenceUtil")!=null){var c=a.getData();c.window_id=d("PresenceUtil").getSessionID();a.setData(c)}a.setHandler(function(a){return D(b,a)}).setErrorHandler(function(a){return E(b,a)}).setTransportErrorHandler(function(a){return E(b,a)}).setFinallyHandler(function(a){return F(a)}).setAllowCrossPageTransition(!0);return a}function H(a,b,d){return G(new(c("AsyncRequest"))(a).setData(b),d)}function a(a,b){a=b.obj;if(a.viewer_id!=c("CurrentUser").getID())throw new Error("Viewer got from the channel is not the real viewer");if(a.window_id===d("PresenceUtil").getSessionID())return;var e=a.data;if(a.event=="access_control_entry")e.target_ids.forEach(function(a){x(a,e.setting),p[a]=e.setting});else{if(a.event=="visibility_update"){b=e.visibility?v.ONLINE:v.OFFLINE;z(b);q=b}else a.event=="online_policy_update"&&(A(e.online_policy),s=e.online_policy);v.inform("privacy-user-presence-response")}}v.inform("privacy-changed");v.inform("privacy-user-presence-changed","state");c("Arbiter").subscribe(d("ChannelConstants").getArbiterType("privacy_changed"),a);c("Arbiter").subscribe(d("ChannelConstants").ON_CONFIG,function(a,b){a=b.getConfig("visibility",null);if(a!==null&&typeof a!=="undefined"){b=a?v.ONLINE:v.OFFLINE;z(b)}});e=v;g["default"]=e}),98);
__d("ChatVisibility",["Arbiter","PresencePrivacy"],(function(a,b,c,d,e,f){var g={isOnline:function(){return b("PresencePrivacy").getVisibility()===b("PresencePrivacy").ONLINE},hasBlackbirdEnabled:function(){return this.isVisibleToMostFriends()||this.isVisibleToSomeFriends()},isVisibleToMostFriends:function(){return b("PresencePrivacy").getOnlinePolicy()===b("PresencePrivacy").ONLINE_TO_BLACKLIST&&b("PresencePrivacy").getBlacklist().length>0},isVisibleToSomeFriends:function(){return b("PresencePrivacy").getOnlinePolicy()===b("PresencePrivacy").ONLINE_TO_WHITELIST&&b("PresencePrivacy").getWhitelist().length>0},goOnline:function(a){b("PresencePrivacy").getVisibility()===b("PresencePrivacy").OFFLINE&&(b("PresencePrivacy").setVisibility(b("PresencePrivacy").ONLINE),b("Arbiter").inform("chat-visibility/go-online")),a&&a()},goOffline:function(a){b("PresencePrivacy").getVisibility()===b("PresencePrivacy").ONLINE&&(b("PresencePrivacy").setVisibility(b("PresencePrivacy").OFFLINE),b("Arbiter").inform("chat-visibility/go-offline")),a&&a()},toggleVisibility:function(){g.isOnline()?g.goOffline():g.goOnline()}};e.exports=g}),null);
__d("LastActiveTimes",["fbt","ServerTime"],(function(a,b,c,d,e,f,g,h){var i={};function j(a){if(!a||a<0)return null;a=d("ServerTime").get()/1e3-a;a=Math.floor(a/60);var b=Math.floor(a/60),c=Math.floor(b/24);if(a<=1)return h._(/*FBT_CALL*/{"*":"{count}m"}/*FBT_CALL*/,[h._param("count",1,[0])]);else if(a<60)return h._(/*FBT_CALL*/{"*":"{count}m"}/*FBT_CALL*/,[h._param("count",a,[0])]);else if(b<24)return h._(/*FBT_CALL*/{"*":"{count}h"}/*FBT_CALL*/,[h._param("count",b,[0])]);else if(c<3)return h._(/*FBT_CALL*/{"*":"{count}d"}/*FBT_CALL*/,[h._param("count",c,[0])]);else return null}function k(a,b){(!(a in i)||i[a]<b)&&(i[a]=b)}function l(a){if(a in i)return i[a];else return 0}function a(a){for(var b in a)k(b,a[b])}function b(a){return j(l(a))}function c(a){return l(a)}function e(){return i}g.update=a;g.getShortDisplay=b;g.get=c;g.getDebugData=e}),98);
__d("PresenceStatus",["ArbiterMixin","AvailableListConstants","AvailableListInitialData","Bootloader","ChatVisibility","CurrentUser","FBIDCheck","FBLogger","LastActiveTimes","ODS","PresenceConfig","PresencePrivacy","ServerTime","createObjectFrom","debounceAcrossTransitions","gkx"],(function(a,b,c,d,e,f,g){d("ODS").setEntitySample("presence",1e-4);var h={},i={},j={},k={},l=babelHelpers["extends"]({},c("ArbiterMixin")),m=c("debounceAcrossTransitions")(function(){return l.inform("change")},0);function n(a){var b,e=parseInt(a.topic.match(/\d+$/),10);a=parseInt(JSON.parse(a.payload).lat,10);var f=Date.now()-a*1e3;f=d("PresenceConfig").get("active_cutoff")*1e3-f;d("LastActiveTimes").update((b={},b[e]=a,b));l.checkPresence(e);l.get(e)===c("AvailableListConstants").ACTIVE&&(window.clearTimeout(k[e].timeout),k[e].timeout=window.setTimeout(function(){l.checkPresence(e)},f))}function o(a){return/^\d+$/.test(a)}Object.assign(l,{resetPresenceData:function(){h={},i={}},reset:function(){l.resetPresenceData(),j={}},get:function(a){!o(a)&&d("PresenceConfig").get("presence_throw_for_malformed_id")&&c("FBLogger")("presence").warn("received malformed id '%s'",a);if(a==c("CurrentUser").getID())return d("ChatVisibility").isOnline()?c("AvailableListConstants").ACTIVE:c("AvailableListConstants").OFFLINE;o(a)&&!d("FBIDCheck").isUser_deprecated(a)&&!k[a]&&(d("ODS").bumpEntityKey(3303,"presence","page_subscribe"),k[a]={},d("PresenceConfig").get("presence_page_green_dot_sub")&&c("Bootloader").loadModules(["SkywalkerManager"],function(b){return b.subscribe("presence_push/fb/"+a,n)},"PresenceStatus"));var b=c("AvailableListConstants").OFFLINE;a in h&&(b=h[a]);c("PresencePrivacy").allows(a)||(b=c("AvailableListConstants").OFFLINE);return b},getCapabilities:function(a){a=i[a];return a?a:0},isPlayingCanvasGameUser:function(a){return!!j[a]},getGroup:function(a){return a.some(function(a){return a==c("CurrentUser").getID()?!1:l.get(a)===c("AvailableListConstants").ACTIVE})?c("AvailableListConstants").ACTIVE:c("AvailableListConstants").OFFLINE},set:function(a,b,e,f,g,j){if(a==c("CurrentUser").getID())return!1;var k;if(b!=null){b=b==c("AvailableListConstants").ACTIVE?c("AvailableListConstants").ACTIVE:c("AvailableListConstants").OFFLINE;e=l.get(a);k=e!=b;if((k||b==c("AvailableListConstants").ACTIVE)&&d("FBIDCheck").isUser_deprecated(a)){d("LastActiveTimes").update((f={},f[a]=d("ServerTime").get()/1e3,f))}h[a]=b}e=!1;g!=null&&(e=l.getCapabilities(a)!=g,i[a]=g);f=k||e;f&&!j&&m();return f},setPlayingCanvasGameFriends:function(a){if(!c("gkx")("678262"))return;j=c("createObjectFrom")(a)},getOnlineIDs:function(){var a,b=[];for(a in h)l.get(a)===c("AvailableListConstants").ACTIVE&&b.push(a);return b},getAllIDs:function(){return Object.keys(h)},getOnlineCount:function(){return l.getOnlineIDs().length},getPresenceStats:function(){var a=0,b=0,d=0;for(var e in h){a+=1;switch(l.get(e)){case c("AvailableListConstants").OFFLINE:b+=1;break;case c("AvailableListConstants").ACTIVE:d+=1;break;default:break}}return{total:a,offline:b,active:d}},getAllDebugInfo:function(){var a={};for(var b in h)a[b]={p:h[b],vc:i[b]};return a},setMultiFromMQTT:function(a){var b={};Array.isArray(a)&&a.forEach(function(a){a.l&&(b[a.u]=a.l),l.set(a.u,a.p,!1,"mqtt",a.c,!0)});d("LastActiveTimes").update(b);m()},setMultiChatproxy:function(a){var b={};for(var c in a){a[c].lat&&(b[c]=a[c].lat);var e=a[c].p;l.set(c,e,!1,"chatproxy",a[c].vc,!0)}d("LastActiveTimes").update(b);m()},setMultiActive:function(a,b){var d=!1;a.forEach(function(a){l.set(a,c("AvailableListConstants").ACTIVE,!1,b,null,!0)&&(d=!0)});d&&m()},checkPresence:function(a){var b=!1,e=Math.ceil(Date.now()/1e3)-d("LastActiveTimes").get(a);l.set(a,e<d("PresenceConfig").get("active_cutoff")?c("AvailableListConstants").ACTIVE:c("AvailableListConstants").OFFLINE,!1,"pylon",null,!0)&&(b=!0);b&&m()}});c("AvailableListInitialData").activeList&&c("AvailableListInitialData").activeList.length>0&&l.setMultiActive(c("AvailableListInitialData").activeList,"available_list_active");c("AvailableListInitialData").playingNow&&c("AvailableListInitialData").playingNow.length>0&&l.setPlayingCanvasGameFriends(c("AvailableListInitialData").playingNow);c("AvailableListInitialData").lastActiveTimes&&Object.keys(c("AvailableListInitialData").lastActiveTimes).length>0&&d("LastActiveTimes").update(c("AvailableListInitialData").lastActiveTimes);a=l;g["default"]=a}),98);
__d("DialogHideOnSuccess",["csx","CSS"],(function(a,b,c,d,e,f,g){a=function(){"use strict";function a(a){this._layer=a}var c=a.prototype;c.enable=function(){this._subscription=this._layer.subscribe("success",this._handle.bind(this))};c.disable=function(){this._subscription.unsubscribe(),this._subscription=null};c._handle=function(a,c){b("CSS").matchesSelector(c.getTarget(),"._s")&&this._layer.hide()};return a}();Object.assign(a.prototype,{_subscription:null});e.exports=a}),null);
__d("onEnclosingPageletDestroy",["Arbiter","DOMQuery"],(function(a,b,c,d,e,f,g){function a(a,b){var e=c("Arbiter").subscribe("pagelet/destroy",function(c,f){d("DOMQuery").contains(f.root,a)&&(e.unsubscribe(),b())});return e}g["default"]=a}),98);
__d("AbstractDockingElement",["Arbiter","Event","FullScreen","Run","SubscriptionsHandler","onEnclosingPageletDestroy","queryThenMutateDOM","removeFromArray"],(function(a,b,c,d,e,f,g){var h=[],i=null;function j(){if(c("FullScreen").isFullScreen())return;c("queryThenMutateDOM")(function(){return h.forEach(function(a){return a.queryDOM()})},function(){return h.forEach(function(a){return a.updateWithCache()})},"AbstractDockingElement")}function k(){i||(i=new(c("SubscriptionsHandler"))(),i.addSubscriptions(c("Event").listen(window,"scroll",j),c("Event").listen(window,"resize",j),d("Run").onLeave(function(){while(h.length)l(h[0])})),i=i);return i}function l(a){try{a.onPageletDestroyed&&c("Arbiter").unsubscribe(a.onPageletDestroyed)}catch(a){}finally{a.onPageletDestroyed=null}if(!i||h.indexOf(a)===-1)return;c("removeFromArray")(h,a);if(h.length)return;i.release();i=null}function a(b,d,e){var a=k(),f={onPageletDestroyed:a.addSubscriptions(c("onEnclosingPageletDestroy")(b,function(){l(f)})),queryDOM:d,updateWithCache:e};h.push(f)}g.register=a}),98);
__d("DirectionalDockingElement",["cx","AbstractDockingElement","Arbiter","CSS","DOM","Scroll","Style","UITinyViewportAction","UserAgent","ViewportBounds","getElementPosition","getStyleProperty","queryThenMutateDOM"],(function(a,b,c,d,e,f,g,h){var i=!0,j=!1,k=c("UserAgent").isBrowser("Safari < 10")||c("UserAgent").isBrowser("Mobile Safari < 10");a=function(){function a(a){this.$11=null,this.$5=0,this.$2=null,this.$7=!1,this.$12=a,this.$8=0,this.$11=null,this.$13=0,this.register(),this.$14=c("ViewportBounds").getTop(),c("Style").set(this.$12,"width",this.$12.getBoundingClientRect().width+"px"),this.$9=c("DOM").create("div"),d("CSS").addClass(this.$9,"_lwx"),c("Style").set(this.$9,"position","relative"),c("DOM").replace(this.$12,this.$9),c("DOM").appendContent(this.$9,this.$12),this.update()}var b=a.prototype;b.register=function(){d("AbstractDockingElement").register(this.getRoot(),this.__queryDOM.bind(this),this.__updateWithCache.bind(this))};b.subscribe=function(a,b,d){this.$1||(this.$1=new(c("Arbiter"))());return this.$1.subscribe(a,b,d)};b.destroy=function(){c("DOM").replace(this.$9,this.$12)};b.__queryDOM=function(){var a=-c("getElementPosition")(this.$9).y;a!==this.$13&&(this.$15=a>this.$13?j:i,this.$13=a);this.$6=this.$12.getBoundingClientRect();a=document;var b=a.body;a=a.documentElement;if(b&&a){var e=a.clientHeight;a=a.scrollHeight;this.$7=d("Scroll").getTop(b)+e>Math.max(e,a)}if(k){this.$11=c("getElementPosition")(this.$9);b=parseInt(c("getStyleProperty")(this.$12,"left"),10);this.$11&&!isNaN(b)&&b!==this.$11.x&&(this.$11=babelHelpers["extends"]({},this.$11,{x:b}))}this.$12.style.position==="fixed"&&(this.$5=c("getElementPosition")(this.$12).y+this.$13)};b.$16=function(a,b,d){if(b===this.$4&&a===this.$3&&d===this.$2)return;var e=a!==this.$3,f={};b!==this.$4&&(f.top=b+"px",this.$4=b);a!==this.$3&&(f.position=a,this.$3=a);k&&(d!==this.$2&&(f.left=typeof d==="number"?d+"px":"auto",this.$2=d));c("Style").apply(this.$12,f);e&&this.$1&&this.$1.inform("changedposition")};b.$17=function(){this.$16("fixed",this.$14,this.$11?this.$11.x:null)};b.$18=function(){this.$16("fixed",this.$8,this.$11?this.$11.x:null)};b.$19=function(){this.$16("absolute",this.$5,null)};b.unfixAndScrollBy=function(a){this.$5=Math.max(0,this.$5-a),this.$19()};b.translateY=function(a){var b=c("getElementPosition")(this.$12).y,d=c("getElementPosition")(this.$9).y;b=b-d;this.$5=a+b;this.$19()};b.__updateWithCache=function(){var a=Math.round(this.$6.height);a!==this.$10&&(c("Style").set(this.$9,"height",a+"px"),this.$10=a,this.$1&&this.$1.inform("changedheight"));if(this.$7)return;if(this.$13+this.$14<0||c("UITinyViewportAction").isTiny()){this.$5=0;this.$19();c("Arbiter").inform("reflow");return}this.$15===j&&this.$13+this.$8>=this.$5?this.$18():this.$15===i&&this.$13+this.$14<=this.$5?this.$17():this.$19();c("Arbiter").inform("reflow")};b.update=function(){var a=this;c("queryThenMutateDOM")(function(){a.__queryDOM()},function(){a.__updateWithCache()})};b.setOffset=function(a){return this.setOffsetAndTop(a,this.$14)};b.setOffsetAndTop=function(a,b){var d=this;c("queryThenMutateDOM")(function(){d.__queryDOM(),d.$8=Math.round(a),d.$14=b},function(){d.__updateWithCache()});return this};b.setTop=function(a){return this.setOffsetAndTop(this.$8,a)};b.getPlaceholder=function(){return this.$9};b.getRoot=function(){return this.$12};return a}();g["default"]=a}),98);
__d("LayerRemoveOnHide",["DOM"],(function(a,b,c,d,e,f,g){a=function(){function a(a){this._layer=a}var b=a.prototype;b.enable=function(){this._subscription=this._layer.subscribe("hide",c("DOM").remove.bind(null,this._layer.getRoot()))};b.disable=function(){this._subscription&&(this._subscription.unsubscribe(),this._subscription=null)};return a}();Object.assign(a.prototype,{_subscription:null});g["default"]=a}),98);